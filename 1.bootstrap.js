(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.hasOwnProperty.call(t,n)&&r(e,t,n);return o(e,t),e},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const u=i(n(2)),c=i(n(3)),l=s(n(6)),a=new RegExp("^X|[0-9]+$");class f extends u.default.PureComponent{constructor(t,e){super(t,e),this.state={content:""}}render(){return u.default.createElement("td",null,u.default.createElement("input",{disabled:null!==this.props.guess,inputMode:"numeric",onBlur:this.onBlur.bind(this),onChange:this.onChange.bind(this),style:{color:this.getColor()},value:this.getContent()}))}getColor(){return 0==this.props.player||this.state.content.length>0?"#d63b3b":1==this.props.player?"#3bd6d0":null}getContent(){return null==this.props.guess?this.state.content:0===this.props.guess?"X":this.props.guess}onBlur(t){if(a.test(this.state.content))try{this.props.onBlur(this.props.row,this.props.col,t)}catch(t){console.log(t)}this.setState({content:""})}onChange(t){return this.setState({content:t.currentTarget.value}),this.props.onChange(this.props.row,this.props.col,t)}}class d extends u.default.PureComponent{constructor(t,e){super(t,e),this.state=this.getGameState()}componentDidMount(){this.bot=l.WasmBot.new(this.props.nrows,this.props.ncols,0),this.setState(this.getGameState()),this.shouldPonder=!0,this.ponder()}componentWillUnmount(){this.shouldPonder=!1,this.bot.free()}getGameState(){let t=[];for(let e=0;e<this.props.nrows;++e){let n=[];for(let t=0;t<this.props.ncols;++t)if(this.bot){const r=this.bot.get_cell(e,t);n.push({guess:void 0!==r.guess?r.guess:null,player:void 0!==r.player?r.player:null})}else n.push({guess:null,player:null});t.push(n)}return{activePlayer:this.bot?this.bot.get_active_player():0,winProb:this.getWinProb(),scores:this.bot?[...this.bot.get_scores()]:[0,0],grid:t}}render(){1===this.state.activePlayer&&window.setTimeout(this.takeBotAction.bind(this),0);const t=[];for(let e=0;e<this.props.nrows;e++){const n=[];for(let t=0;t<this.props.ncols;t++){const{guess:r,player:o}=this.state.grid[e][t];n.push(u.default.createElement(f,{col:t,guess:r,key:`${e},${t}`,onBlur:this.onCellInputBlur.bind(this),onChange:this.onCellInputChange.bind(this),player:o,row:e}))}t.push(u.default.createElement("tr",{key:e},n))}let e=null;var n;return null!=this.state.winProb&&(e=u.default.createElement("div",{className:"prediction"},"The CPU thinks you have a ",u.default.createElement("span",{style:{color:"#d63b3b"}},(n=this.state.winProb,new Intl.NumberFormat("en-US",{maximumSignificantDigits:4}).format(100*n)+"%"))," chance of winning.")),u.default.createElement("div",{className:"prophecies-game"},u.default.createElement("table",null,u.default.createElement("tbody",null,t)),u.default.createElement("div",{className:"scores"},u.default.createElement("div",null,"Scores:"),u.default.createElement("div",null,u.default.createElement("span",{style:{color:"#d63b3b"}},this.state.scores[0]),u.default.createElement("span",null," - "),u.default.createElement("span",{style:{color:"#3bd6d0"}},this.state.scores[1])),e))}onCellInputBlur(t,e,n){if(null!==this.state.grid[t][e].player)return;const r=n.currentTarget.value;if(!r||!r.length||!a.test(r))return;const o="X"===r?0:parseInt(r,10);this.takeAction({row:t,col:e,guess:o})}onCellInputChange(t,e,n){const r=n.target;a.test(r.value)||console.log(r.value+" failed regex")}ponder(){if(!this.shouldPonder)return;if(this.bot.is_finished())return void(this.shouldPonder=!1);const t=performance.now();let e=0;for(;performance.now()-t<128;)this.bot.playout(),++e;const n=performance.now();console.log(`${e} playouts in ${n-t} ms`),this.setState({winProb:this.getWinProb()}),window.setTimeout(this.ponder.bind(this),1024)}getWinProb(){if(!this.bot)return null;if(0!==this.bot.get_active_player())return null;const t=this.bot.get_best_action();return null==t?null:(1+t.score/Number(t.visits))/2}takeAction(t){t&&(this.bot.place(t.row,t.col,t.guess),this.setState(this.getGameState()))}takeBotAction(){const t=performance.now();for(;performance.now()-t<256;)this.bot.playout();const e=this.bot.get_best_action();null!=e?this.takeAction(e.action):this.shouldPonder=!1}}c.default.render(u.default.createElement(d,{nrows:4,ncols:4}),document.getElementById("prophecies-grid-container"))},,,function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return E})),n.d(e,"b",(function(){return P})),n.d(e,"c",(function(){return C})),n.d(e,"d",(function(){return k})),n.d(e,"q",(function(){return O})),n.d(e,"i",(function(){return j})),n.d(e,"m",(function(){return x})),n.d(e,"f",(function(){return B})),n.d(e,"o",(function(){return S})),n.d(e,"h",(function(){return A})),n.d(e,"j",(function(){return T})),n.d(e,"l",(function(){return D})),n.d(e,"k",(function(){return W})),n.d(e,"e",(function(){return M})),n.d(e,"n",(function(){return N})),n.d(e,"g",(function(){return U})),n.d(e,"r",(function(){return q})),n.d(e,"p",(function(){return F}));var r=n(5);let o=new("undefined"==typeof TextDecoder?(0,t.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});o.decode();let s=null;function i(){return null!==s&&s.buffer===r.y.buffer||(s=new Uint8Array(r.y.buffer)),s}function u(t,e){return o.decode(i().subarray(t,t+e))}const c=new Array(32).fill(void 0);c.push(void 0,null,!0,!1);let l=c.length;function a(t){l===c.length&&c.push(c.length+1);const e=l;return l=c[e],c[e]=t,e}function f(t){return c[t]}function d(t){const e=f(t);return function(t){t<36||(c[t]=l,l=t)}(t),e}let p=null;function h(){return null!==p&&p.buffer===r.y.buffer||(p=new Int32Array(r.y.buffer)),p}function b(t){return null==t}let g=null;function _(t,e){return(null!==g&&g.buffer===r.y.buffer||(g=new Uint32Array(r.y.buffer)),g).subarray(t/4,t/4+e)}let w=0;let m=new("undefined"==typeof TextEncoder?(0,t.require)("util").TextEncoder:TextEncoder)("utf-8");const y="function"==typeof m.encodeInto?function(t,e){return m.encodeInto(t,e)}:function(t,e){const n=m.encode(t);return e.set(n),{read:t.length,written:n.length}};function v(t,e){return i().subarray(t/1,t/1+e)}class E{static __wrap(t){const e=Object.create(E.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,r.q(t)}get row(){return r.c(this.ptr)>>>0}set row(t){r.k(this.ptr,t)}get col(){return r.a(this.ptr)>>>0}set col(t){r.i(this.ptr,t)}get guess(){return r.b(this.ptr)>>>0}set guess(t){r.j(this.ptr,t)}}class P{static __wrap(t){const e=Object.create(P.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,r.r(t)}static new(t,e,n){var o=r.E(t,e,n);return P.__wrap(o)}is_finished(){return 0!==r.D(this.ptr)}get_scores(){r.C(8,this.ptr);var t=h()[2],e=h()[3],n=_(t,e).slice();return r.v(t,4*e),n}get_cell(t,e){var n=r.B(this.ptr,t,e);return C.__wrap(n)}place(t,e,n){r.F(this.ptr,t,e,n)}playout(){r.G(this.ptr)}get_active_player(){return r.z(this.ptr)>>>0}get_best_action(){var t=r.A(this.ptr);return 0===t?void 0:k.__wrap(t)}}class C{static __wrap(t){const e=Object.create(C.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,r.s(t)}get player(){r.e(8,this.ptr);var t=h()[2],e=h()[3];return 0===t?void 0:e>>>0}set player(t){r.m(this.ptr,!b(t),b(t)?0:t)}get guess(){r.d(8,this.ptr);var t=h()[2],e=h()[3];return 0===t?void 0:e>>>0}set guess(t){r.l(this.ptr,!b(t),b(t)?0:t)}}class k{static __wrap(t){const e=Object.create(k.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,r.t(t)}get action(){var t=r.f(this.ptr);return E.__wrap(t)}set action(t){!function(t,e){if(!(t instanceof e))throw new Error("expected instance of "+e.name);t.ptr}(t,E);var e=t.ptr;t.ptr=0,r.n(this.ptr,e)}get visits(){return r.h(this.ptr)}set visits(t){r.p(this.ptr,t)}get score(){return r.g(this.ptr)}set score(t){r.o(this.ptr,t)}}const O=function(t,e){return a(u(t,e))},j=function(){return a(new Error)},x=function(t,e){var n=function(t,e,n){if(void 0===n){const n=m.encode(t),r=e(n.length);return i().subarray(r,r+n.length).set(n),w=n.length,r}let r=t.length,o=e(r);const s=i();let u=0;for(;u<r;u++){const e=t.charCodeAt(u);if(e>127)break;s[o+u]=e}if(u!==r){0!==u&&(t=t.slice(u)),o=n(o,r,r=u+3*t.length);const e=i().subarray(o+u,o+r);u+=y(t,e).written}return w=u,o}(f(e).stack,r.w,r.x),o=w;h()[t/4+1]=o,h()[t/4+0]=n},B=function(t,e){try{console.error(u(t,e))}finally{r.v(t,e)}},S=function(t){d(t)},A=function(t,e,n){f(t).getRandomValues(v(e,n))},T=function(t,e,n){f(t).randomFillSync(v(e,n))},D=(I=function(){return a(self.self)},function(){try{return I.apply(this,arguments)}catch(t){r.u(a(t))}});var I;const W=function(t,e){return a(n(8)(u(t,e)))},M=function(t){return a(f(t).crypto)},N=function(t){return void 0===f(t)},U=function(t){return a(f(t).getRandomValues)},q=function(t,e){throw new Error(u(t,e))},F=function(t){throw d(t)}}).call(this,n(7)(t))},function(t,e,n){"use strict";var r=n.w[t.i];t.exports=r;n(4);r.H()},function(t,e,n){"use strict";n.r(e);var r=n(4);n.d(e,"WasmAction",(function(){return r.a})),n.d(e,"WasmBot",(function(){return r.b})),n.d(e,"WasmCell",(function(){return r.c})),n.d(e,"WasmEdge",(function(){return r.d})),n.d(e,"__wbindgen_string_new",(function(){return r.q})),n.d(e,"__wbg_new_59cb74e423758ede",(function(){return r.i})),n.d(e,"__wbg_stack_558ba5917b466edd",(function(){return r.m})),n.d(e,"__wbg_error_4bb6c2a97407129a",(function(){return r.f})),n.d(e,"__wbindgen_object_drop_ref",(function(){return r.o})),n.d(e,"__wbg_getRandomValues_f5e14ab7ac8e995d",(function(){return r.h})),n.d(e,"__wbg_randomFillSync_d5bd2d655fdf256a",(function(){return r.j})),n.d(e,"__wbg_self_1b7a39e3a92c949c",(function(){return r.l})),n.d(e,"__wbg_require_604837428532a733",(function(){return r.k})),n.d(e,"__wbg_crypto_968f1772287e2df0",(function(){return r.e})),n.d(e,"__wbindgen_is_undefined",(function(){return r.n})),n.d(e,"__wbg_getRandomValues_a3d34b4fee3c2869",(function(){return r.g})),n.d(e,"__wbindgen_throw",(function(){return r.r})),n.d(e,"__wbindgen_rethrow",(function(){return r.p}))},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=8}]]);